<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/default}">

<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
</head>

<body>
	<div layout:fragment="content">
		<div class="content container-fluid">
			<div>ì‚¬ìš©ì í˜ì´ì§€</div>
			<div class="box">
				<div class="box-header with-bordered">
					<button class="btn btn-primary" id="viewTable">ì¡°íšŒ</button>
					<button class="btn btn-warning" id="addRecord">ë“±ë¡</button>
					<button class="btn btn-warning" id="updateRecord">ìˆ˜ì •</button>
					<button class="btn btn-warning" id="deleteRecord">ì‚­ì œ</button>
				</div>
				<hr />
				<div class="box-body">
					<h2>TEST_NOUGAT0 í…Œì´ë¸” ì¡°íšŒ</h2>
					<div id="gridContainer"></div>
				</div>
				</hr>
			</div>
			<!--addRecordModal ì‹œì‘-->
			<div class="modal" id="addRecordModal">
				<div class="modal-dialog">
					<div class="modal-content">
						<!-- Modal Header -->
						<div class="modal-header">
							<h4 class="modal-title">íšŒì› ì…ë ¥</h4>
						</div>
						<!-- Modal body -->
						<div class="modal-body">
							<form id="addRecordForm" action="/page1/regi" method="post">
								<label>ì´ë¦„:</label>
								<input type="text" class="form-control userNm" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" name="userNm">
								<br />
								<label>ì•„ì´ë””:</label>
								<input type="text" class="form-control userId" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”" name="userId">
								<br />
								<label>ë¹„ë°€ë²ˆí˜¸:</label>
								<input type="password" class="form-control pw" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" name="pw">
								<br />
								<label>ë¹„ë°€ë²ˆí˜¸ í™•ì¸:</label>
								<input type="password" class="form-control pw2" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ í•œ ë²ˆ ë” ì…ë ¥í•˜ì„¸ìš”">
								<br />
								<label>ë“±ë¡ì ì•„ì´ë””:</label>
								<input type="text" class="form-control regiUser" placeholder="ë“±ë¡ìì˜ ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
									name="regiUser">
							</form>
						</div>
						<!-- Modal footer -->
						<div class="modal-footer">
							<button type="submit" id="addSubmitBtn" class="btn btn-info ">ì €ì¥</button>
							<button type="button" id="addCloseBtn" class="btn btn-danger "
								data-dismiss="modal">ë‹«ê¸°</button>
						</div>
					</div>
				</div>
			</div>
			<!--addRecordModal ë-->
			<!--updateRecordModal ì‹œì‘-->
			<div class="modal" id="updateRecordModal">
				<div class="modal-dialog">
					<div class="modal-content">
						<!-- Modal Header -->
						<div class="modal-header">
							<h4 class="modal-title">íšŒì› ìˆ˜ì •</h4>
						</div>
						<!-- Modal body -->
						<div class="modal-body">
							<form id="updateRecordForm" action="/page1/update" method="post">
								<label>ì´ë¦„:</label>
								<input type="text" class="form-control userNm" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" name="userNm">
								<br />
								<label>ì•„ì´ë””:</label>
								<input type="text" class="form-control userId" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”" name="userIdAfter">
								<br />
								<label>ë¹„ë°€ë²ˆí˜¸:</label>
								<input type="password" class="form-control pw" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" name="pw">
								<br />
								<label>ë¹„ë°€ë²ˆí˜¸ í™•ì¸:</label>
								<input type="password" class="form-control pw2" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ í•œ ë²ˆ ë” ì…ë ¥í•˜ì„¸ìš”">
								<br />
								<label>ìˆ˜ì •í•œ ì ì•„ì´ë””:</label>
								<input type="text" class="form-control regiUser" placeholder="ë“±ë¡ìì˜ ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
									name="updaUser">
								<input type="hidden" class="form-control userId" name="userIdBefore">
							</form>
						</div>
						<!-- Modal footer -->
						<div class="modal-footer">
							<button type="submit" id="updateSubmitBtn" class="btn btn-info ">ì €ì¥</button>
							<button type="button" id="updateCloseBtn" class="btn btn-danger "
								data-dismiss="modal">ì·¨ì†Œ</button>
						</div>
					</div>
				</div>
			</div>
			<!--updateRecordModal ë-->
		</div>
	</div>
	<th:block layout:fragment="script">
		<script type="text/javascript">
			$(function () {
				//multiple select ì „ìš© ë³€ìˆ˜
				let selectedRows;

				// ğŸ”” Spring ê³¼ì œ 2ì°¨ ğŸ””
				var GRID = { //grid ë¥¼ ë§Œë“œëŠ” ë° í•„ìš”í•œ ì†ì„±ë“¤ ì •ì˜
					columns: [{
						dataField: "regiDt"
						, caption: "ë“±ë¡ì¼"
						, dataType: "date"
						, format: "yyyy-MM-dd"
					}, {
						dataField: "regiUser"
						, caption: "ë“±ë¡ì ì•„ì´ë””"
						//dataType: "text"
						//ë°ì´í„° íƒ€ì… ë””í´íŠ¸ëŠ” text, ì´ ê²½ìš°ì—ëŠ” ëª…ì‹œ ì•ˆí•´ì¤˜ë„ ë¨
						, validationRules: [{ type: "required" }]
					}, {
						dataField: "userNm"
						, caption: "ì´ë¦„"
						, validationRules: [{ type: "required" }]
					}, {
						dataField: "userId"
						, caption: "ì•„ì´ë””"
						, fixed: true //ì—‘ì…€ì—ì„œ nì—´ê¹Œì§€ ê³ ì • ê¸°ëŠ¥ê³¼ ìœ ì‚¬. ê°€ë¡œ ìŠ¤í¬ë¡¤ì´ ìƒê¸¸ ì‹œ í•´ë‹¹ ì»¬ëŸ¼ì„ ê³ ì •í•´ì„œ í•­ìƒ ë³´ì´ê²Œ í•¨.
						, sortOrder: "asc" //ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
						, validationRules: [{ type: "required" }]
					}, {
						dataField: "pw"
						, caption: "ë¹„ë°€ë²ˆí˜¸"
						, visible: false
						, validationRules: [{ type: "required" }]
					}, {
						dataField: "updaDt"
						, caption: "ìˆ˜ì •ì¼"
						, dataType: "date"
						, format: "yyyy-MM-dd"
					}, {
						dataField: "updaUser"
						, caption: "ìˆ˜ì •ì ì•„ì´ë””"  //dataField ì™¸ì— ëª…ì‹œí•  ì†ì„±ì´ ì—†ë‹¤ë©´ ì¤‘ê´„í˜¸ ì—†ì´ ê·¸ëƒ¥ "ì»¬ëŸ¼ëª…" ë§Œ ì¶”ê°€í•´ë„ ë¨.
					}]
					, makeGrid: function (data) {
						var grid = $('#gridContainer').dxDataGrid({
							dataSource: data //array ì „ë‹¬, í•¨ìˆ˜ ë„£ì–´ë„ ë¨ (return ê°’ ì „ë‹¬)
							, keyExpr: "userId" //pkì˜ í•„ë“œëª… ë„˜ê¸°ê¸°
							// array ì™¸ì˜ ë°ì´í„°ë¥¼ ë„˜ê¸°ê³  ì‹¶ì„ ê²½ìš°(JSON) Docs ì°¸ê³ 
							, columns: GRID.columns//ì‚¬ìš©í•˜ëŠ” ì»¬ëŸ¼ì •ë³´ ë°°ì—´ë¡œ ë„˜ê¸°ê¸° [{ì»¬ëŸ¼1ì •ë³´},{ì»¬ëŸ¼2ì •ë³´},{ì»¬ëŸ¼3ì •ë³´}]
							, noDataText: "ë°ì´í„°ê°€ğŸ””ì—†ìŠµë‹ˆë‹¤"
							, allowColumnResizing: true
							, columnAutoWith: true
							, columnFixing: { enabled: true }
							, sorting: { mode: "single" } //ì •ë ¬ ì˜µì…˜ì„ ë‹¨ì¼ì •ë ¬ë§Œ í•˜ê¸°. (ë‹¤ì¤‘ ì •ë ¬x)
							, searchPanel: {
								visible: true
								, placeholder: "ê²€ìƒ‰"
							} //ê²€ìƒ‰ì°½ ì¶”ê°€
							, selection: { mode: "multiple" } //ë‹¤ì¤‘ ì„ íƒ ì˜µì…˜ on
							, onSelectionChanged: function (e) {
								selectedRows = e;
							}
							, toolbar: {
								items: [
									"searchPanel"
								]
							}
						}).dxDataGrid("instance"); // instance ê°€ì ¸ì™€ì„œ ë‹´ê¸°
						return grid;
					}
					, loadDataSource: function () {
						
						$.ajax({
							url: '/page1/table',
							dataType: 'json',
							contentType: "application/json; charset=UTF-8",
							success: function (data, status, xhr) {
								GRID.makeGrid(data);
								//console.log('data.Columns: ' + data.Columns);
								//console.log('GRID.Columns: ' + GRID.Columns);
								//alert('ajaxë¡œ ìƒˆë¡œ ë°ì´í„°ë¥¼ ë°›ì•„ì™”ì–´ìš”');
							},
							error: function (request, status, error) {
								alert('ë°ì´í„° ë¡œë“œì¤‘ ì˜¤ë¥˜ ë°œìƒ');
								console.log('request.status: ' + request.status + 'status: ' + status + 'error: ' + error);
							}
						});
						//console.log('ajaxë¡œ ìƒˆë¡œ ë°ì´í„°ë¥¼ ë°›ì•„ì™”ì–´ìš”');
					}
				}///GRID

				var GRID_CRUD_SUBMIT = {
					addMember: function (form) {
						//ajaxë¡œ dbì— ë°ì´í„° ì…ë ¥ ìš”ì²­
						$.ajax({
							url: '/page1/regi',
							type: 'post',
							data: form, //formíƒœê·¸ì— serialize() + JSON.stringify()
							contentType: "application/x-www-form-urlencoded; charset=UTF-8",
							success: function (data, status, xhr) {
								alert('ì •ìƒ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤');
								console.log('data: ' + data);
							},
							error: function (request, status, error) {
								alert('ì…ë ¥ ì¤‘ ì—ëŸ¬');
								console.log('request.status: ' + request.status + 'status: ' + status + 'error: ' + error);
							}
						});
					}
					, updateMember: function (form) {
						//ajaxë¡œ dbì— ë°ì´í„° ìˆ˜ì • ìš”ì²­
						$.ajax({
							url: '/page1/update',
							type: 'post',
							data: form,
							contentType: "application/x-www-form-urlencoded; charset=UTF-8",
							success: function (data, status, xhr) {
								alert('ì •ìƒ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤');
								console.log('data: ' + data);
							},
							error: function (request, status, error) {
								alert('ìˆ˜ì • ì¤‘ ì—ëŸ¬');
								console.log('request.status: ' + request.status + 'status: ' + status + 'error: ' + error);
							}

						});
					}
					, deleteMember: function (key) {
						//ajaxë¡œ dbì— ë°ì´í„° ìˆ˜ì • ìš”ì²­
						$.ajax({
							url: '/page1/delete',
							type: 'post',
							data: {key: key},
							//dataType: 'json',
							contentType: "application/x-www-form-urlencoded; charset=UTF-8",
							success: function (data, status, xhr) {
								alert('ì •ìƒ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
								console.log('data: ' + data);
							},
							error: function (request, status, error) {
								alert('ì‚­ì œ ì¤‘ ì—ëŸ¬');
								console.log('request.status: ' + request.status + 'status: ' + status + 'error: ' + error);
							}

						});
					}
					, validationAndSubmit: function (type) {
						if ($('#' + type + 'RecordForm > input[class=userNm]').val() == '') {
							alert('ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”');
							return false;
						}
						else if ($('#' + type + 'RecordForm > input[class=userId]').val() == '') {
							alert('ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
							return false;
						}
						else if ($('#' + type + 'RecordForm > input[class=pw]').val() == '') {
							alert('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
							return false;
						}
						else if ($('#' + type + 'RecordModal > input[class=regiUser]').val() == '') {
							alert('ë“±ë¡ì ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
							return false;
						}
						else if ( type=="add" && $('#' + type + 'RecordForm > input[class=pw]').val() != $('#' + type + 'RecordForm > input[class=pw2]').val()) {
							alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
							return false;
						}
						
						console.log(type);
						console.log('#'+type+'RecordForm > input[class=userNm]');
						console.log($('#' + type + 'RecordForm > input[class="userNm"]'));
						console.log($('#addRecordForm > input[class="userNm"]'));

						var form = $('#' + type + 'RecordForm').serialize();
						var formJSON = JSON.stringify($('#' + type + 'RecordForm').serialize());
						switch (type) {
							case "add": 
								GRID_CRUD_SUBMIT.addMember(form);
								break;
							case "update": 
								GRID_CRUD_SUBMIT.updateMember(form); 
								break;
							}
						GRID_MODAL.modalClose(type);
						console.log('validation ë° '+type+'ê³¼ì • ì§„í–‰ì™„ë£Œ');
					}
					, ifBlankReturnFalse: function (type, inputClass, message) {
						if ($('#' + type + 'RecordForm > input[class=' + inputClass + ']').val() == '') {
							alert(message + 'ì„(ë¥¼) ì…ë ¥í•˜ì„¸ìš”');
							return false;
						}
					}
				}///GRID_CRUD_SUBMIT

				var GRID_MODAL = {
					modalClose: function(type){
						console.log('ì´ê±¸ë¡œ ê°€ì ¸ì™€ì§€ë‚˜?:'+$('#' + type + 'RecordModal'));
						
						//modal ë‹«ê¸°
						$('#' + type + 'RecordModal').modal('hide');
						//modal ë‹«íˆë©´ input ê°’ë“¤ ë¹„ìš°ê¸°
						//$('#' + type + 'RecordModal').on('hidden.bs.modal', function () {
						$('#' + type + 'RecordModal').find('input').val('').end();
						//ë°ì´í„° ìƒˆë¡œê³ ì¹¨
						GRID.loadDataSource();							
						
					}
					/*
					, buttonModal: function(button,type){
						switch(type){
							case "add":
								switch(button){
									case "Submit":
										GRID_CRUD_SUBMIT.validationAndSubmit('add');
									case "Close":
										GRID_MODAL.modalClose('add'); break;
								}
							case "update":
								switch(button){
									case "Submit":

								}
						}
						
						
						$('#' + type + 'Btn')
					}
					*/
				}



				function init() {
					$('.box-body').hide();
				}


		


				//ì¡°íšŒ
				$('#viewTable').on('click', function () {
					$('.box-body').show();
				});

				//ë“±ë¡ í¼ ì—´ê¸°
				$('#addRecord').on('click', function () {
					//modal ì—´ê¸°
					$('#addRecordModal').modal('show');
				});
				//ì €ì¥ ë²„íŠ¼
				$('#addSubmitBtn').on('click', function () {
					GRID_CRUD_SUBMIT.validationAndSubmit('add');
				});
				//ë‹«ê¸° ë²„íŠ¼
				$('#addCloseBtn').on('click', function () {
					if(!confirm('ë“±ë¡ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return false;
					else{
						GRID_MODAL.modalClose('add');		
					}
				});

				///////////////////////////////////////////////

				//ìˆ˜ì •
				$('#updateRecord').on('click', function () {
					//í•˜ë‚˜ë§Œ ì„ íƒí–ˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ë¡œì§
					if (selectedRows === undefined) {
						alert('ìˆ˜ì •í•  íšŒì›ì„ ì„ íƒí•´ì£¼ì„¸ìš”!');
						return false;
					} else if (selectedRows.selectedRowKeys.length > 1) {
						alert('í•œ ë²ˆì— í•œ ëª…ë§Œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤');
						return false;
					}
					var data = selectedRows.selectedRowsData[0];
					//input íƒœê·¸ ì±„ì›Œë„£ê¸°
					$('#updateRecordForm > input.form-control.userNm').val(data.userNm);
					$('#updateRecordForm > input.form-control.userId').val(data.userId); //2ê°œ ì„ íƒ
					$('#updateRecordForm > input.form-control.pw').val(data.pw);
					$('#updateRecordForm > input.form-control.regiUser').val(data.regiUser);

					$('#updateRecordModal').modal('show');
				});
					
				//ì €ì¥ ë²„íŠ¼
				$('#updateSubmitBtn').on('click', function () {
					GRID_CRUD_SUBMIT.validationAndSubmit('update');
				});
				//ë‹«ê¸° ë²„íŠ¼
				$('#updateCloseBtn').on('click', function () {
					if(!confirm('ìˆ˜ì •ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return false;
					else{
						GRID_MODAL.modalClose('update');		
					}
				});
				//ë°ì´í„° ìƒˆë¡œê³ ì¹¨
				//GRID.loadDataSource();
				
				////////////////////////////////////////////////////////

				//ì‚­ì œ
				$('#deleteRecord').on('click', function () {
					if (selectedRows === undefined) {
						alert('ì‚­ì œí•  íšŒì›ì„ ì„ íƒí•´ì£¼ì„¸ìš”!');
						return false;
					}
					//nê°œì˜ í–‰ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? confirm
					else if (!confirm(selectedRows.selectedRowKeys.length + 'ëª…ì˜ ì •ë³´ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return false;
					else{
						GRID_CRUD_SUBMIT.deleteMember(selectedRows.selectedRowKeys);
						//ë°ì´í„° ìƒˆë¡œê³ ì¹¨
						GRID.loadDataSource();
					}
				});


				//ì´ˆê¸°í™”
				init();
				console.log()
				
				GRID.loadDataSource();



			});
		</script>
	</th:block>
</body>

</html>